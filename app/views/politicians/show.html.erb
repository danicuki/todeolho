<script>
$(function() {
  $("#searchPolitician").select2({
    placeholder: "Busque por um político",
    minimumInputLength: 1,
        ajax: { // instead of writing the function to execute the request we use Select2's convenient helper
        url: "http://api.rottentomatoes.com/api/public/v1.0/movies.json",
        dataType: 'json',
        data: function (term, page) {
          return {
                    q: term, // search term
                    page_limit: 10,
                    apikey: "ju6z9mjyajq2djue3gbvv26t" // please do not use so this example keeps working
                  };
                },
            results: function (data, page) { // parse the results into the format expected by Select2.
                // since we are using custom formatting functions we do not need to alter remote JSON data
                return {results: data.movies};
              }
            },
            initSelection: function(element, callback) {
            // the input tag has a value attribute preloaded that points to a preselected movie's id
            // this function resolves that id attribute to an object that select2 can render
            // using its formatResult renderer - that way the movie name is shown preselected
            var id=$(element).val();
            if (id!=="") {
              $.ajax("http://api.rottentomatoes.com/api/public/v1.0/movies/"+id+".json", {
                data: {
                  apikey: "ju6z9mjyajq2djue3gbvv26t"
                },
                dataType: "jsonp"
              }).done(function(data) { callback(data); });
            }
          },
        // formatResult: movieFormatResult, // omitted for brevity, see the source of this page
        // formatSelection: movieFormatSelection,  // omitted for brevity, see the source of this page
        dropdownCssClass: "bigdrop", // apply css that makes the dropdown taller
        escapeMarkup: function (m) { return m; } // we do not want to escape markup since we are displaying html in results
      });

      $('#notifications-button').click(function() {
        $('.active').removeClass();
        $(this).closest('li').addClass('active');
        $('#infos-section').hide();
        $('#notifications-section').show();
        return false;
      });

     $('#infos-button').click(function() {
      $('.active').removeClass();
      $(this).closest('li').addClass('active');
      $('#notifications-section').hide();
      $('#infos-section').show();
      return false;
    });
  });
</script>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="row">
      <div class="col-md-2"></div>
      <div class="col-md-8">
        <div class="navbar-header">
          <a class="navbar-brand" href="#"><img src="<%= image_url 'simbolo.png' %>" alt=""></a>
        </div>
        <div class="navbar-collapse collapse">
          <form class="navbar-form" role="form">
            <input type="text" id="searchPolitician" class="form-control">
          </form>
        </div><!--/.navbar-collapse -->
      </div>
      <div class="col-md-2"></div>
    </div>
  </div>
</div>

<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron with-navbar">
  <div class="container">
    <div class="row">
      <div class="col-md-2"></div>
      <div class="col-md-8">
        <%= render 'politician' %>
        <hr/>
        <p><%= @politician.bio %></p>
        <br>
        <label class='col-sm-2'></label>
        <button class="btn btn-default col-sm-8" id="follow" data-toggle="modal" data-target="#follow-subscribe">Fique de Olho</button>
        <div class="col-sm-2"></div>
      </div>
      <div class="col-md-2"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
      <ul class="nav nav-tabs nav-justified" role="tablist">
        <li class="active"><a href="#" id="notifications-button">NOTIFICAÇÕES</a></li>
        <li><a href="#" id="infos-button">INFOS</a></li>
      </ul>
      <div id="notifications-section">
        <div class="row">
        <% @notifications.each do |notification| %>
          <div class="col-md-6">
            <div class="dialog">
              <div class="thumb small-thumb dialog-img"><%= image_tag 'simbolo.png' %></div>
              <div class="dialog-box">
                <h4><%= notification.category %></h4>
                <span><%= time_ago_in_words notification.created_at %></span>
                <p><%=

raw(
notification.message

)                 %></p>
              </div>
            </div>
         </div>
         <% end %>
      </div>
    </div>
      <div id="infos-section">
        <div class="row">
          <div class="col-md-4">
            <div class="info">
              <div class="thumb circle-small-thumb info-img"></div>
              <strong>ESTADO</strong>
              <span><%= @politician.state %></span>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info">
              <div class="thumb circle-small-thumb info-img"></div>
              <strong>Título</strong>
              <span><%= @politician.title %></span>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info">
              <div class="thumb circle-small-thumb info-img"></div>
              <strong>CASA</strong>
              <span><%= @politician.house %></span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="info">
              <div class="thumb circle-small-thumb info-img"></div>
              <strong>CARGOS PASSADOS</strong>
              <span><%= @politician.past_jobs %></span>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info">
              <div class="thumb circle-small-thumb info-img"></div>
              <strong>PARTIDOS PASSADOS</strong>
              <span><%= @politician.past_parties %></span>
            </div>
          </div>
        </div>
        <div class="history">
          <h4>Hitórico de cargos</h4>
        <p><%= @politician.job_title %></p>
        </div>
      </div>
    </div>
    <div class="col-md-2"></div>
  </div>
</div> <!-- /container -->

<div class="modal fade bs-example-modal-sm" id="follow-subscribe" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h3>Fique de olho em:</h3>
        <hr>
        <%= render :partial => "politician", locals: {hide_social: true} %>
        <hr>
        <p>            Preencha os campos para seguir <strong><%= @politician.name %></strong> e receber informações sobre sua movimentação.</p>
        <%= form_for User.new do |f| %>
        <form role="form">
          <div class="form-group">
            <input type="hidden" name="politician_id" value="<%= @politician.id %>" />
            <%= f.text_field :name, class: "form-control", placeholder: "Nome" %>
          </div>
          <div class="form-group">
            <%= f.text_field :email, class: "form-control", placeholder: "Email" %>
          </div>
          <div class="form-group">
            <%= f.text_field :phone, class: "form-control", placeholder: "Telefone" %>
          </div>
          <button type="submit" class="btn btn-default">Cadastrar</button>
        <% end %>
      </div>
    </div>
  </div>
</div>
